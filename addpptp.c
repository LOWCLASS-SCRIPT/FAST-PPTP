#if 0
	L O W C L A S S - V P N , 
	 LOWCLASS VPN SSH

#endif

static  char data [] = 
#define      msg1_z	42
#define      msg1	((&data[7]))
	"\200\246\136\041\025\163\332\263\352\172\021\153\031\245\132\232"
	"\207\367\353\261\205\137\155\330\357\266\061\167\171\131\377\063"
	"\106\137\336\256\333\360\274\054\220\240\062\134\260\135\225\221"
	"\175\274\117"
#define      shll_z	10
#define      shll	((&data[53]))
	"\360\014\174\054\154\246\306\325\342\103\253\011"
#define      chk1_z	22
#define      chk1	((&data[63]))
	"\100\070\004\256\353\171\020\171\301\267\313\166\376\164\146\277"
	"\276\170\330\031\246\267\152"
#define      rlax_z	1
#define      rlax	((&data[86]))
	"\323"
#define      opts_z	1
#define      opts	((&data[87]))
	"\112"
#define      date_z	1
#define      date	((&data[88]))
	"\304"
#define      msg2_z	19
#define      msg2	((&data[93]))
	"\335\173\342\073\217\215\201\276\321\172\073\304\262\064\362\316"
	"\204\137\227\326\171\174\043\235"
#define      chk2_z	19
#define      chk2	((&data[116]))
	"\264\377\263\333\174\032\110\130\125\307\277\265\137\210\114\352"
	"\115\131\072\344\154\340\143\005"
#define      text_z	1841
#define      text	((&data[339]))
	"\305\235\000\172\256\201\076\063\235\123\023\056\376\015\152\334"
	"\211\115\030\046\105\307\236\372\306\122\135\314\367\316\141\274"
	"\153\141\066\032\343\164\116\201\310\141\257\307\157\032\243\370"
	"\147\273\037\254\202\276\246\111\020\004\025\007\322\167\303\076"
	"\331\372\131\274\157\247\075\067\011\355\376\170\010\242\161\157"
	"\135\221\034\340\117\303\051\137\310\076\147\233\265\053\332\216"
	"\045\063\113\224\333\211\314\344\167\313\135\177\155\317\356\312"
	"\140\013\252\260\316\324\017\227\022\167\062\310\242\014\127\310"
	"\077\242\134\033\053\051\377\242\364\135\041\142\054\020\055\215"
	"\033\330\075\352\254\115\201\276\304\263\206\146\300\335\056\000"
	"\200\213\033\254\265\033\116\252\170\160\014\244\201\072\062\235"
	"\022\157\207\276\275\011\175\201\275\004\350\175\342\027\175\142"
	"\243\231\016\130\264\135\003\054\316\017\307\022\121\032\020\161"
	"\153\136\056\221\117\047\232\352\140\032\223\006\200\345\064\327"
	"\156\377\227\171\242\106\126\151\154\022\125\156\313\274\260\213"
	"\340\257\124\241\334\105\145\035\014\150\313\365\342\160\301\247"
	"\376\351\350\107\371\133\340\222\026\351\343\141\257\021\246\134"
	"\240\037\246\043\003\161\300\143\360\050\301\015\034\153\171\327"
	"\024\212\005\042\154\114\257\247\343\322\023\220\310\035\140\102"
	"\352\302\020\250\177\055\256\151\221\234\277\105\146\300\063\255"
	"\255\137\107\164\004\266\132\106\017\052\151\300\004\347\114\356"
	"\317\177\257\003\102\254\205\064\064\305\340\027\137\361\077\014"
	"\206\070\026\350\337\303\236\361\101\226\344\344\007\077\206\007"
	"\225\330\333\112\160\004\205\271\103\311\042\371\252\306\352\213"
	"\207\334\036\057\265\350\031\373\210\120\160\113\067\316\370\036"
	"\344\246\304\300\237\016\052\327\006\144\042\147\010\302\273\365"
	"\122\222\160\073\312\303\034\351\013\034\266\241\224\047\116\254"
	"\104\206\040\246\302\266\321\334\342\070\210\212\376\321\006\012"
	"\007\013\063\177\271\341\176\061\211\345\024\303\075\132\031\337"
	"\364\202\375\301\046\043\005\341\331\336\373\067\242\250\274\256"
	"\202\263\247\237\111\134\331\063\370\325\145\041\047\002\120\143"
	"\131\216\060\022\303\111\161\120\212\120\143\145\255\063\054\034"
	"\334\374\243\023\160\275\254\211\061\232\377\067\034\111\162\140"
	"\265\140\146\300\301\022\054\332\004\234\377\126\257\256\245\165"
	"\202\164\066\366\151\365\164\171\201\301\202\110\351\141\131\024"
	"\211\300\134\322\004\045\320\332\245\376\212\163\324\370\352\252"
	"\140\021\063\272\306\270\163\060\242\255\375\223\144\345\030\233"
	"\211\063\133\334\344\047\042\224\233\344\371\252\163\351\316\101"
	"\161\227\217\240\315\272\033\302\323\262\342\055\171\063\016\260"
	"\124\167\065\231\063\233\157\037\317\050\361\177\142\175\105\271"
	"\207\146\177\205\027\057\315\174\033\045\157\246\160\366\342\326"
	"\132\376\130\244\261\116\257\131\227\021\070\305\332\245\362\157"
	"\103\201\240\301\221\070\242\247\176\100\155\040\267\010\207\110"
	"\301\270\025\136\034\141\300\247\043\076\073\104\201\135\220\127"
	"\040\072\045\020\313\244\064\320\302\051\200\110\274\373\255\053"
	"\072\110\320\031\346\363\243\325\167\003\307\211\011\313\374\162"
	"\263\014\070\272\041\356\317\056\002\367\130\264\133\072\151\032"
	"\034\323\303\200\171\062\354\334\073\304\077\236\033\026\257\056"
	"\264\204\001\066\053\241\072\225\355\157\024\076\315\103\337\103"
	"\360\356\360\237\277\126\071\207\330\040\131\314\143\250\270\064"
	"\311\036\206\036\006\277\110\143\153\174\374\102\032\224\021\221"
	"\234\333\136\122\274\244\204\213\107\203\134\370\055\121\055\310"
	"\075\353\212\023\015\344\170\220\313\357\225\234\137\116\300\005"
	"\135\053\122\112\155\117\274\256\360\254\275\357\106\162\241\050"
	"\220\005\175\152\243\005\025\235\127\075\313\204\177\126\062\136"
	"\144\315\263\201\141\072\217\000\226\274\034\006\055\362\132\022"
	"\146\356\105\375\013\121\072\210\162\375\075\055\152\035\111\024"
	"\313\300\216\154\271\341\140\176\356\335\364\372\031\071\363\175"
	"\350\227\037\077\345\233\231\315\323\265\255\140\317\277\217\070"
	"\211\242\103\375\251\255\357\025\144\127\031\035\344\334\064\352"
	"\061\111\111\156\256\071\220\152\146\121\372\160\032\240\301\365"
	"\372\072\007\165\351\324\111\340\272\322\214\317\004\323\003\027"
	"\203\330\101\256\030\357\011\234\317\237\155\330\354\107\246\327"
	"\315\333\305\347\106\076\231\347\227\230\252\263\066\313\043\052"
	"\116\017\367\347\065\240\073\234\202\013\350\271\242\200\166\372"
	"\256\304\026\223\050\011\125\105\335\046\020\326\353\275\303\141"
	"\140\144\245\204\114\363\336\073\322\150\225\277\252\105\305\052"
	"\007\057\255\016\233\147\010\216\104\342\105\075\067\221\001\134"
	"\047\240\313\077\224\262\302\326\375\312\354\035\255\035\117\101"
	"\252\151\301\216\116\062\265\326\045\071\151\011\074\236\041\157"
	"\216\320\145\127\306\205\065\012\273\335\125\371\337\324\233\174"
	"\174\117\141\372\162\216\153\233\035\063\165\117\103\033\126\357"
	"\007\361\325\360\202\356\152\350\116\164\315\011\362\146\253\360"
	"\125\234\203\154\261\031\021\263\100\173\143\222\300\377\301\330"
	"\342\270\344\122\013\362\267\353\064\167\255\000\151\015\151\076"
	"\012\056\215\055\216\275\042\162\373\214\102\373\142\232\130\367"
	"\113\376\107\146\013\162\030\353\007\014\070\311\003\244\322\052"
	"\126\044\212\147\172\246\272\364\366\163\201\265\300\261\367\301"
	"\063\147\175\120\270\317\355\255\105\023\205\226\345\161\123\371"
	"\171\200\074\113\274\222\356\363\254\335\376\222\034\134\315\152"
	"\343\257\052\000\213\027\061\013\064\302\261\233\152\103\155\123"
	"\267\022\035\010\346\045\136\164\106\057\204\076\367\013\254\060"
	"\374\237\061\133\034\177\075\141\367\072\147\317\134\225\367\243"
	"\275\030\111\072\225\273\330\317\026\125\217\247\240\165\020\067"
	"\107\326\013\326\012\154\253\143\147\117\353\056\024\267\334\116"
	"\207\132\066\025\015\261\125\131\021\376\057\177\110\160\132\336"
	"\260\213\373\363\161\137\261\076\267\002\027\102\015\066\162\375"
	"\065\053\014\303\056\122\160\372\024\044\073\025\371\056\337\260"
	"\172\140\306\137\373\155\203\257\253\265\136\113\115\076\144\316"
	"\250\331\353\331\100\340\157\033\005\105\130\216\310\046\222\063"
	"\242\067\053\170\112\363\055\274\052\167\121\163\256\174\206\140"
	"\207\364\170\123\314\336\273\147\107\334\322\104\023\224\043\064"
	"\254\110\210\154\372\261\356\373\160\351\343\210\041\024\163\175"
	"\377\350\217\321\203\172\112\363\207\006\311\110\257\152\200\332"
	"\364\202\015\164\010\360\336\266\120\172\356\337\146\030\031\154"
	"\342\241\304\137\075\043\055\247\123\241\165\045\330\326\104\070"
	"\360\217\263\073\256\263\165\016\361\220\136\212\251\117\234\172"
	"\221\203\255\335\372\137\276\344\114\006\214\151\261\331\356\041"
	"\051\233\035\030\022\031\211\272\355\166\217\073\142\324\213\204"
	"\263\144\106\337\054\340\140\174\005\376\225\210\002\354\262\166"
	"\060\247\123\026\050\047\233\077\013\336\151\072\321\164\072\104"
	"\350\130\224\251\366\062\177\017\342\210\010\235\021\332\121\067"
	"\106\153\307\241\323\063\260\135\346\265\031\151\245\021\041\117"
	"\235\032\353\075\212\360\062\001\144\367\265\152\013\256\273\233"
	"\212\174\106\170\154\003\167\226\055\116\200\317\103\053\113\323"
	"\155\240\152\270\157\376\320\104\114\240\267\200\135\071\302\001"
	"\022\363\335\323\346\103\017\120\031\065\115\215\274\232\173\302"
	"\311\241\076\260\023\260\015\257\311\236\325\042\007\307\370\123"
	"\344\055\270\327\132\303\345\373\236\144\152\016\314\034\240\321"
	"\054\310\201\206\011\365\322\162\161\335\115\265\343\011\332\324"
	"\011\057\037\371\021\220\054\001\045\032\026\173\321\035\146\014"
	"\361\070\305\162\304\374\060\103\314\216\024\057\026\052\134\216"
	"\230\140\354\254\264\044\333\275\267\324\143\353\063\210\367\124"
	"\245\374\305\054\166\307\034\254\330\210\050\256\122\306\346\050"
	"\216\200\300\070\103\110\130\140\202\357\244\103\072\343\250\100"
	"\047\063\136\321\042\014\375\241\046\051\270\126\135\204\053\120"
	"\254\065\020\176\165\116\363\225\372\122\132\261\172\355\016\117"
	"\022\272\210\011\041\054\330\234\226\013\043\360\012\077\315\223"
	"\144\073\246\267\236\165\046\333\204\104\031\065\325\027\005\171"
	"\176\365\072\143\332\065\264\222\334\102\266\254\145\143\011\054"
	"\313\043\251\332\152\336\304\364\260\333\224\056\171\341\026\056"
	"\110\146\074\121\141\220\351\176\264\230\122\135\326\060\370\153"
	"\054\076\257\241\217\226\233\024\132\355\216\371\333\360\014\305"
	"\141\107\260\036\303\244\342\055\313\367\053\154\132\175\354\006"
	"\061\004\174\100\042\216\267\377\065\325\220\265\300\246\027\152"
	"\106\011\025\347\153\266\241\337\216\342\220\243\110\144\214\232"
	"\247\313\132\212\002\361\016\254\363\365\322\050\267\010\017\005"
	"\133\235\072\314\007\234\000\110\147\133\330\321\117\111\003\354"
	"\134\163\164\032\060\175\230\262\072\234\233\270\176\262\066\341"
	"\125\317\357\256\203\115\261\260\033\301\202\152\013\205\126\147"
	"\371\312\202\052\110\032\334\203\266\170\073\065\052\162\026\200"
	"\102\005\056\305\123\340\166\156\241\370\330\254\176\057\024\167"
	"\372\226\242\102\260\177\306\147\367\002\234\042\164\263\242\266"
	"\270\321\174\013\261\363\172\123\353\122\000\152\202\024\341\174"
	"\252\204\277\133\003\205\303\373\210\140\035\374\023\277\263\314"
	"\221\060\330\102\044\122\226\017\244\226\171\047\252\133\243\125"
	"\340\143\261\343\351\164\337\161\324\374\156\350\274\042\264\115"
	"\123\214\220\167\336\046\206\203\274\000\253\147\134\116\274\074"
	"\262\155\040\233\342\377\014\267\374\173\237\270\235\124\006\360"
	"\341\227\147\300\275\356\104\172\357\357\342\113\076\236\210\360"
	"\014\250\213\357\250\230\246\244\023\106\135\261\233\143\242\174"
	"\372\012\074\270\370\200\063\350\157\025\063\255\264\274\235\300"
	"\144\051\260\015\302\127\261\326\236\017\207\071\163\051\265\155"
	"\063\361\046\054\162\131\024\341\157\110\217\043\004\055\344\151"
	"\126\224\166\031\353\050\357\211"
#define      inlo_z	3
#define      inlo	((&data[2449]))
	"\135\036\237"
#define      tst2_z	19
#define      tst2	((&data[2455]))
	"\030\324\152\361\152\245\046\330\002\014\076\016\317\274\264\127"
	"\115\000\067\357\026\174\077\001"
#define      pswd_z	256
#define      pswd	((&data[2514]))
	"\276\007\136\116\053\143\173\017\315\322\243\103\353\217\154\333"
	"\031\244\122\333\117\363\124\147\307\276\247\311\233\100\337\132"
	"\107\076\250\163\241\043\011\310\322\033\036\245\151\152\203\002"
	"\231\171\222\347\350\012\004\146\320\313\166\062\012\316\226\073"
	"\064\320\124\264\337\136\175\261\171\233\127\343\006\333\345\240"
	"\124\170\207\075\202\214\244\123\127\032\206\142\350\034\236\035"
	"\354\363\322\314\121\117\175\313\353\325\256\361\260\224\221\005"
	"\014\031\103\217\245\347\342\374\002\150\137\352\204\375\010\161"
	"\360\332\075\102\052\273\015\025\221\274\007\102\120\231\110\134"
	"\262\213\354\127\162\316\124\164\067\263\137\274\261\147\056\241"
	"\102\154\344\154\050\361\202\271\256\211\374\376\042\104\133\324"
	"\317\110\054\102\026\200\267\116\064\027\013\345\176\071\207\301"
	"\246\153\055\316\135\257\210\013\071\204\012\133\310\146\060\230"
	"\256\135\332\305\336\222\023\022\251\036\367\050\130\177\351\377"
	"\352\027\315\110\306\126\124\000\332\136\133\243\304\214\074\162"
	"\351\027\070\307\251\113\332\122\152\322\172\303\121\144\302\074"
	"\173\220\204\102\346\330\102\301\067\236\145\373\053\241\156\024"
	"\270\246\334\141\362\266\264\135\211\057\041\332\223\343\026\017"
	"\163\233\121\132\164\224\202\156\366\046\262"
#define      xecc_z	15
#define      xecc	((&data[2777]))
	"\275\316\260\160\345\101\275\372\037\155\021\003\171\263\027\035"
	"\123"
#define      lsto_z	1
#define      lsto	((&data[2792]))
	"\347"
#define      tst1_z	22
#define      tst1	((&data[2793]))
	"\030\027\105\373\177\371\027\331\206\277\062\207\114\307\313\077"
	"\015\354\215\337\324\254\172\312\275\041\223"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
